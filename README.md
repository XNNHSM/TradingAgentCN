# TradingAgentCN

åŸºäºå¤§è¯­è¨€æ¨¡å‹(LLM)å’Œé˜¿é‡Œäº‘ç™¾ç‚¼MCPåè®®çš„æ™ºèƒ½äº¤æ˜“å†³ç­–ç³»ç»Ÿï¼Œä¸“é—¨é’ˆå¯¹ä¸­å›½Aè‚¡å¸‚åœºè®¾è®¡ã€‚é€šè¿‡æ™ºèƒ½ä½“ååŒåˆ†æã€å®æ—¶æ•°æ®é‡‡é›†å’Œå¤šç»´åº¦æ™ºèƒ½åˆ†æï¼Œä¸ºæŠ•èµ„è€…æä¾›ä¸“ä¸šçš„äº¤æ˜“å»ºè®®å’Œé£é™©è¯„ä¼°ã€‚

## âš ï¸ æŠ•èµ„é£é™©é¢„è­¦

**é‡è¦æç¤ºï¼šæœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ å’ŒæŠ€æœ¯ç ”ç©¶ä½¿ç”¨ï¼Œä¸æ„æˆä»»ä½•æŠ•èµ„å»ºè®®ï¼**

### é£é™©å£°æ˜
- **å¸‚åœºé£é™©**ï¼šè‚¡ç¥¨å¸‚åœºå…·æœ‰é«˜åº¦æ³¢åŠ¨æ€§ï¼ŒæŠ•èµ„å¯èƒ½é¢ä¸´é‡å¤§æŸå¤±
- **ç³»ç»Ÿå±€é™æ€§**ï¼šAIåˆ†æåŸºäºå†å²æ•°æ®å’Œç®—æ³•æ¨¡å‹ï¼Œæ— æ³•é¢„æµ‹å¸‚åœºçªå‘äº‹ä»¶
- **æ•°æ®å‡†ç¡®æ€§**ï¼šç³»ç»Ÿä¾èµ–çš„æ•°æ®æ¥æºå¯èƒ½å­˜åœ¨å»¶è¿Ÿã€é”™è¯¯æˆ–ä¸å®Œæ•´æ€§
- **æ¨¡å‹é£é™©**ï¼šå¤§è¯­è¨€æ¨¡å‹å¯èƒ½äº§ç”Ÿä¸å‡†ç¡®æˆ–è¯¯å¯¼æ€§çš„åˆ†æç»“æœ
- **æŠ€æœ¯æ•…éšœ**ï¼šè½¯ä»¶ç³»ç»Ÿå¯èƒ½å­˜åœ¨bugã€æœåŠ¡ä¸­æ–­æˆ–æ•°æ®ä¸¢å¤±é£é™©
- **è¿‡æ‹Ÿåˆé£é™©**ï¼šåŸºäºå†å²æ•°æ®çš„åˆ†æå¯èƒ½ä¸é€‚ç”¨äºæœªæ¥å¸‚åœºç¯å¢ƒ

### ä½¿ç”¨å»ºè®®
1. **ä»…ä¾›å­¦ä¹ **ï¼šå»ºè®®ä»…ç”¨äºå­¦æœ¯ç ”ç©¶ã€æŠ€æœ¯å­¦ä¹ å’ŒAIåº”ç”¨æ¢ç´¢
2. **è°¨æ…å†³ç­–**ï¼šå¦‚éœ€å®é™…æŠ•èµ„ï¼Œè¯·å’¨è¯¢ä¸“ä¸šé‡‘èé¡¾é—®ï¼Œè¿›è¡Œç‹¬ç«‹åˆ¤æ–­
3. **é£é™©æ§åˆ¶**ï¼šå®é™…æŠ•èµ„è¯·ä¸¥æ ¼æ§åˆ¶ä»“ä½ï¼Œè®¾ç½®æ­¢æŸç‚¹
4. **å¤šæ–¹éªŒè¯**ï¼šæŠ•èµ„å†³ç­–åº”ç»“åˆå¤šç§ä¿¡æ¯æºå’Œä¸“ä¸šæ„è§
5. **åˆè§„è¦æ±‚**ï¼šç¡®ä¿æŠ•èµ„è¡Œä¸ºç¬¦åˆå½“åœ°æ³•å¾‹æ³•è§„å’Œç›‘ç®¡è¦æ±‚

### å…è´£å£°æ˜
æœ¬é¡¹ç›®å¼€å‘è€…ä¸å¯¹å› ä½¿ç”¨æœ¬ç³»ç»Ÿè€Œäº§ç”Ÿçš„ä»»ä½•æŠ•èµ„æŸå¤±æ‰¿æ‹…è´£ä»»ã€‚ç”¨æˆ·åº”å……åˆ†äº†è§£æŠ•èµ„é£é™©ï¼Œç†æ€§æŠ•èµ„ï¼Œè‡ªè´Ÿç›ˆäºã€‚

## ğŸ¯ æ ¸å¿ƒä»·å€¼

- **æ™ºèƒ½å·¥ä½œæµ**: æ•°æ®æ”¶é›† â†’ ä¸“ä¸šåˆ†æ â†’ å†³ç­–æ•´åˆ â†’ ç»“æœé€šçŸ¥çš„å®Œæ•´åˆ†æé“¾è·¯
- **å¤šæ™ºèƒ½ä½“ååŒ**: æŒ‰éœ€è°ƒç”¨ï¼Œä¸¥æ ¼éµå¾ªè‚¡ç¥¨åˆ†ææ ‡å‡†æµç¨‹
- **å…¨æ™¯æ·±åº¦åˆ†æ**: åŸºæœ¬é¢ã€æŠ€æœ¯é¢ã€è¡Œä¸šç¯å¢ƒã€ç«äº‰ä¼˜åŠ¿ã€ä¼°å€¼ã€é£é™©å¤šç»´åº¦åˆ†æ
- **MCP+LLMåŒå¼•æ“**: MCPæ•°æ®è·å– + LLMæ™ºèƒ½åˆ†æçš„å®Œç¾ç»“åˆ
- **æˆæœ¬å¯æ§**: æŒ‰éœ€è°ƒç”¨åŸåˆ™ï¼Œé¿å…é‡å¤MCPè°ƒç”¨ï¼Œæ™ºèƒ½æˆæœ¬ç®¡ç†
- **å®æ—¶é€šçŸ¥**: æ”¯æŒé’‰é’‰ã€ä¼ä¸šå¾®ä¿¡ç­‰å¤šç§æ¶ˆæ¯æ¸ é“ï¼ŒåŠæ—¶æ¨é€åˆ†æç»“æœå’Œé‡è¦ä¿¡æ¯

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æŠ€æœ¯æ ˆ
- **æ¡†æ¶**: NestJS + TypeScript + TypeORM
- **æ™ºèƒ½ä½“**: LangChain.js + é˜¿é‡Œäº‘ç™¾ç‚¼MCPåè®®
- **æ•°æ®è·å–**: MCP (Model Context Protocol) ç»Ÿä¸€æ¥å£
- **ä¸»è¦LLM**: é˜¿é‡Œäº‘ç™¾ç‚¼(DashScope)
- **æ•°æ®åº“**: PostgreSQL + Redis
- **å·¥ä½œæµå¼•æ“**: 
  - **ç”Ÿäº§ç¯å¢ƒ**: Temporal - åˆ†å¸ƒå¼å·¥ä½œæµåè°ƒå’ŒçŠ¶æ€ç®¡ç†
  - **å¼€å‘ä¸­**: LangGraphJS - æ™ºèƒ½ä½“å·¥ä½œæµç¼–æ’å¼•æ“
- **æ¶ˆæ¯é€šçŸ¥**: ç»Ÿä¸€æ¶ˆæ¯å‘é€æ¶æ„ï¼Œæ”¯æŒé’‰é’‰ã€ä¼ä¸šå¾®ä¿¡ç­‰Webhook
- **éƒ¨ç½²**: Docker å®¹å™¨åŒ–

### å·¥ä½œæµæ¶æ„
```
# ä¼ ç»Ÿæ¶æ„ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
APIæ¥å£å±‚ â†’ NestJSæœåŠ¡å±‚ â†’ Temporalå·¥ä½œæµå¼•æ“ â†’ æ™ºèƒ½ä½“å·¥ä½œæµ â†’ MCPåè®®å±‚ â†’ é˜¿é‡Œäº‘ç™¾ç‚¼æ•°æ®æœåŠ¡ â†’ å­˜å‚¨ç¼“å­˜å±‚

# æ–°æ¶æ„ï¼ˆå¼€å‘ä¸­ï¼‰
APIæ¥å£å±‚ â†’ NestJSæœåŠ¡å±‚ â†’ LangGraphJSå·¥ä½œæµå¼•æ“ â†’ æ™ºèƒ½ä½“èŠ‚ç‚¹ â†’ MCPåè®®å±‚ â†’ é˜¿é‡Œäº‘ç™¾ç‚¼æ•°æ®æœåŠ¡ â†’ å­˜å‚¨ç¼“å­˜å±‚

å·¥ä½œæµè¯¦ç»†æ¶æ„ï¼š
æ•°æ®æ”¶é›† (MCP+LLM) â†’ ä¸“ä¸šåˆ†æ (çº¯LLM) â†’ å†³ç­–æ•´åˆ (çº¯LLM) â†’ æ¶ˆæ¯é€šçŸ¥ (Webhook)

å®šæ—¶ä»»åŠ¡æ¶æ„ï¼š
æ™ºèƒ½åˆ†æè°ƒåº¦å™¨ â†’ è‡ªé€‰è‚¡è·å– â†’ è‚¡ç¥¨åˆ†æå­å·¥ä½œæµ â†’ ç»“æœé€šçŸ¥
```

### æ™ºèƒ½ä½“æ¶æ„
```
æ•°æ®æ”¶é›†é˜¶æ®µ
â”œâ”€â”€ BasicDataAgent          # åŸºç¡€ä¿¡æ¯+å®æ—¶æ•°æ® (MCP+LLM)
â”œâ”€â”€ TechnicalAnalystAgent   # å†å²+æŠ€æœ¯æŒ‡æ ‡ (MCP+LLM)
â”œâ”€â”€ FundamentalAnalystAgent # è´¢åŠ¡æ•°æ® (MCP+LLM)

ä¸“ä¸šåˆ†æé˜¶æ®µ (çº¯LLM)
â”œâ”€â”€ IndustryAnalystAgent    # è¡Œä¸šç¯å¢ƒåˆ†æ
â”œâ”€â”€ CompetitiveAnalystAgent # ç«äº‰ä¼˜åŠ¿åˆ†æ
â”œâ”€â”€ ValuationAnalystAgent   # ä¼°å€¼æ°´å¹³åˆ†æ
â””â”€â”€ RiskAnalystAgent        # é£é™©å› ç´ åˆ†æ

å†³ç­–æ•´åˆé˜¶æ®µ (çº¯LLM)
â””â”€â”€ UnifiedOrchestratorAgent # ç»¼åˆå†³ç­–ç”Ÿæˆ
```

### è‚¡ç¥¨åˆ†ææ ‡å‡†æµç¨‹

| åˆ†ææ­¥éª¤ | å¯¹åº”æ™ºèƒ½ä½“ | MCPå·¥å…·è°ƒç”¨ | LLMåˆ†æå†…å®¹ |
|---------|-----------|-------------|------------|
| 1. è‚¡ç¥¨åŸºç¡€ä¿¡æ¯ | BasicDataAgent | get_stock_basic_info, get_stock_realtime_data | å…¬å¸æ¦‚å†µã€å¸‚å€¼åˆ†æ |
| 2. åŸºæœ¬é¢æ•°æ® | FundamentalAnalystAgent | get_stock_financial_data | è´¢åŠ¡å¥åº·åº¦ã€ç›ˆåˆ©èƒ½åŠ› |
| 3. è¡Œä¸šç¯å¢ƒ | IndustryAnalystAgent | åŸºäºå·²æœ‰æ•°æ® | è¡Œä¸šå‰æ™¯ã€æ”¿ç­–å½±å“ |
| 4. ç«äº‰ä¼˜åŠ¿ | CompetitiveAnalystAgent | åŸºäºå·²æœ‰æ•°æ® | æŠ¤åŸæ²³ã€å¸‚åœºåœ°ä½ |
| 5. å¸‚åœºæƒ…ç»ª | TechnicalAnalystAgent | get_stock_historical_data, get_stock_technical_indicators | æŠ€æœ¯èµ°åŠ¿ã€èµ„é‡‘æµå‘ |
| 6. ä¼°å€¼æ°´å¹³ | ValuationAnalystAgent | åŸºäºå·²æœ‰æ•°æ® | PE/PBåˆ†æã€ä¼°å€¼åˆç†æ€§ |
| 7. é£é™©å› ç´  | RiskAnalystAgent | åŸºäºå·²æœ‰æ•°æ® | é£é™©è¯†åˆ«ã€é£é™©é‡åŒ– |
| 8. ç»¼åˆåˆ¤æ–­ | UnifiedOrchestratorAgent | åŸºäºå·²æœ‰æ•°æ® | æŠ•èµ„å»ºè®®ã€è¡ŒåŠ¨è®¡åˆ’ |

## ğŸš€ LangGraphJS æ¶æ„å‡çº§ï¼ˆå¼€å‘ä¸­ï¼‰

### æ¶æ„ä¼˜åŠ¿
æˆ‘ä»¬æ­£åœ¨å¼•å…¥ LangGraphJS æ¥å‡çº§ç°æœ‰çš„å·¥ä½œæµå¼•æ“ï¼Œå®ç°æ›´å¼ºå¤§çš„æ™ºèƒ½ä½“ç¼–æ’èƒ½åŠ›ï¼š

- **ğŸ¯ å£°æ˜å¼å·¥ä½œæµ**: ä½¿ç”¨å›¾ç»“æ„å®šä¹‰æ™ºèƒ½ä½“æ‰§è¡Œæµç¨‹ï¼Œæ›´ç›´è§‚æ˜“ç»´æŠ¤
- **ğŸ”„ è‡ªåŠ¨çŠ¶æ€ç®¡ç†**: æ— éœ€æ‰‹åŠ¨ä¼ é€’çŠ¶æ€ï¼Œç³»ç»Ÿè‡ªåŠ¨å¤„ç†ä¸Šä¸‹æ–‡å…±äº«
- **âš¡ æ™ºèƒ½å¹¶å‘**: åŸºäºä¾èµ–å…³ç³»çš„æœ€ä¼˜å¹¶å‘æ‰§è¡Œï¼Œæå‡30%æ€§èƒ½
- **ğŸ”€ åŠ¨æ€è·¯ç”±**: åŸºäºä¸­é—´ç»“æœçš„æ¡ä»¶åˆ†æ”¯å’Œæ™ºèƒ½é”™è¯¯æ¢å¤
- **ğŸ“Š å¯è§†åŒ–è°ƒè¯•**: æ‰§è¡Œè·¯å¾„å¯è§†åŒ–ï¼Œä¾¿äºé—®é¢˜å®šä½å’Œä¼˜åŒ–

### æ¶æ„å¯¹æ¯”

| ç‰¹æ€§ | Temporal (å½“å‰) | LangGraphJS (æ–°) |
|------|-----------------|-------------------|
| **çŠ¶æ€ç®¡ç†** | æ‰‹åŠ¨åºåˆ—åŒ–/ååºåˆ—åŒ– | è‡ªåŠ¨çŠ¶æ€ä¼ é€’å’Œå…±äº« |
| **ç¼–ç¨‹æ¨¡å‹** | å‘½ä»¤å¼ï¼ŒåŸºäº Activity | å£°æ˜å¼ï¼ŒåŸºäºå›¾ç»“æ„ |
| **å¹¶å‘æ§åˆ¶** | å›ºå®šé˜¶æ®µåˆ’åˆ† | æ™ºèƒ½ä¾èµ–åˆ†æ |
| **é”™è¯¯å¤„ç†** | ç®€å•é‡è¯•æœºåˆ¶ | æ™ºèƒ½é”™è¯¯æ¢å¤å’Œé™çº§ |
| **å¼€å‘æ•ˆç‡** | éœ€è¦å¤§é‡æ ·æ¿ä»£ç  | å‡å°‘40%ä»£ç é‡ |
| **è°ƒè¯•èƒ½åŠ›** | åŸºäºæ—¥å¿—åˆ†æ | å¯è§†åŒ–æ‰§è¡Œè·¯å¾„ |

### è¿ç§»ç­–ç•¥
1. **æ¸è¿›å¼è¿ç§»**: ä¿æŒç°æœ‰åŠŸèƒ½çš„åŒæ—¶ï¼Œé€æ­¥è¿ç§»åˆ°æ–°æ¶æ„
2. **å‘åå…¼å®¹**: APIæ¥å£ä¿æŒä¸å˜ï¼Œç¡®ä¿å¹³æ»‘å‡çº§
3. **æ··åˆæ¨¡å¼**: æ”¯æŒæ–°æ—§æ¶æ„å¹¶å­˜ï¼Œçµæ´»åˆ‡æ¢

### å¼€å‘çŠ¶æ€
- âœ… **é˜¶æ®µ1**: åŸºç¡€è®¾æ–½æ­å»ºå’Œé€‚é…å™¨å¼€å‘
- ğŸ”„ **é˜¶æ®µ2**: æ ¸å¿ƒå·¥ä½œæµé‡æ„ï¼ˆè¿›è¡Œä¸­ï¼‰
- ğŸ“‹ **é˜¶æ®µ3**: é«˜çº§ç‰¹æ€§å®ç°ï¼ˆåŠ¨æ€è·¯ç”±ã€ç›‘æ§ç­‰ï¼‰

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Node.js 18+
- PostgreSQL 15+
- Redis 7.0+
- Temporal Server (é€šè¿‡Docker)
- npm æˆ– yarn

### å®‰è£…ä¾èµ–
```bash
npm install
# LangGraphJS å·²ä½œä¸ºæ ¸å¿ƒä¾èµ–è‡ªåŠ¨å®‰è£…
```

### ç¯å¢ƒé…ç½®
1. å¤åˆ¶ç¯å¢ƒé…ç½®æ–‡ä»¶ï¼š
```bash
cp .env.example .env
```

2. ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œé…ç½®æ•°æ®åº“å’ŒRedisè¿æ¥ä¿¡æ¯ï¼š
```bash
# æ•°æ®åº“é…ç½® (PostgreSQL)
DB_HOST=localhost
DB_PORT=5432
DB_USERNAME=postgres
DB_PASSWORD=test_123!
DB_DATABASE=trading_agent

# Redisé…ç½®
REDIS_HOST=localhost
REDIS_PORT=6379

# é˜¿é‡Œäº‘ç™¾ç‚¼APIé…ç½® (å¿…éœ€)
DASHSCOPE_API_KEY=your_dashscope_api_key

# Temporal å·¥ä½œæµé…ç½®
TEMPORAL_HOST=localhost
TEMPORAL_PORT=7233
# æ³¨æ„: TEMPORAL_NAMESPACE å’Œ TEMPORAL_TASK_QUEUE å·²ç§»é™¤
# ç°åœ¨ç”±å„æ¨¡å—æ ¹æ®æ–°è§„èŒƒè‡ªè¡Œç®¡ç†
WORKFLOW_EXECUTION_TIMEOUT=30m
ACTIVITY_EXECUTION_TIMEOUT=5m
ACTIVITY_RETRY_ATTEMPTS=3

# ç¯å¢ƒæ ‡è¯†
NODE_ENV=dev  # dev | test | stg | prd

# MCPæ™ºèƒ½ä½“é…ç½® (å¯é€‰)
COMPREHENSIVE_ANALYST_MODEL=qwen-plus
COMPREHENSIVE_ANALYST_TEMPERATURE=0.7
COMPREHENSIVE_ANALYST_MAX_TOKENS=4000

TRADING_STRATEGIST_MODEL=qwen-plus  
TRADING_STRATEGIST_TEMPERATURE=0.6
TRADING_STRATEGIST_MAX_TOKENS=3000

# LangGraphJS é…ç½® (å¯é€‰ï¼Œå¼€å‘ä¸­)
WORKFLOW_ENGINE=temporal        # temporal | langgraph
LANGGRAPHJS_DEBUG=false         # å¯ç”¨ LangGraphJS è°ƒè¯•æ¨¡å¼
LANGGRAPHJS_RECURSION_LIMIT=100 # æœ€å¤§é€’å½’æ·±åº¦
LANGGRAPHJS_TIMEOUT=10m         # å·¥ä½œæµè¶…æ—¶æ—¶é—´
```

### æ•°æ®åº“åˆå§‹åŒ–
```bash
# ä½¿ç”¨Dockerå¿«é€Ÿå¯åŠ¨PostgreSQL
docker run --name trading-postgres \
  -e POSTGRES_USER=postgres \
  -e POSTGRES_PASSWORD=test_123! \
  -e POSTGRES_DB=trading_agent \
  -p 5432:5432 -d postgres:15

# æˆ–æ‰‹åŠ¨åˆ›å»ºæ•°æ®åº“
psql -U postgres -c "CREATE DATABASE trading_agent;"

# è¿è¡Œæ•°æ®åº“è¿ç§»ï¼ˆå¼€å‘æ¨¡å¼ä¼šè‡ªåŠ¨åŒæ­¥è¡¨ç»“æ„ï¼‰
npm run start:dev
```

### å¯åŠ¨åº”ç”¨
```bash
# å¼€å‘æ¨¡å¼
npm run start:dev

# ç”Ÿäº§æ¨¡å¼
npm run build
npm run start:prod
```

åº”ç”¨å¯åŠ¨åè®¿é—®ï¼š
- APIæœåŠ¡: http://localhost:3000/api/v1
- APIæ–‡æ¡£: http://localhost:3000/api-docs

### æœåŠ¡éªŒè¯
```bash
# è¿è¡Œæ™ºèƒ½ä½“é›†æˆæµ‹è¯•
npm test -- --testPathPattern="unified/.*\.spec\.ts"

# è¿è¡ŒMCPå®¢æˆ·ç«¯æµ‹è¯•  
npm test -- --testPathPattern="mcp-client.service.spec.ts"

# è¿è¡Œå®Œæ•´çš„MCPé›†æˆæµ‹è¯•
npm test -- --testPathPattern="mcp-integration.spec.ts"
```

## ğŸ“š API æ–‡æ¡£

åº”ç”¨å¯åŠ¨åè®¿é—®ï¼š
- APIæœåŠ¡: http://localhost:3000/api/v1
- APIæ–‡æ¡£: http://localhost:3000/api-docs

### ä¸»è¦æ¥å£æ¨¡å—

#### æ™ºèƒ½ä½“åˆ†ææ¥å£
- å¢å¼ºç‰ˆè‚¡ç¥¨åˆ†æ (ä¸‰é˜¶æ®µå·¥ä½œæµ)
- ä¼ ç»Ÿå•é˜¶æ®µåˆ†æ (å…¼å®¹)
- æ‰¹é‡è‚¡ç¥¨åˆ†æ

#### è‡ªé€‰è‚¡ç®¡ç†æ¥å£  
- è‡ªé€‰è‚¡å¢åˆ æ”¹æŸ¥
- æŒä»“è‚¡ç¥¨ç®¡ç†


#### æ¶ˆæ¯é€šçŸ¥æ¥å£
- ç»Ÿä¸€æ¶ˆæ¯å‘é€ (æ”¯æŒé’‰é’‰ã€ä¼ä¸šå¾®ä¿¡)
- æ‰¹é‡æ¶ˆæ¯å‘é€
- åˆ†æç»“æœæ¨é€

#### å¥åº·æ£€æŸ¥æ¥å£
- ç³»ç»Ÿå¥åº·çŠ¶æ€
- æ•°æ®åº“è¿æ¥æ£€æŸ¥
- Redisè¿æ¥æ£€æŸ¥

#### Temporalå·¥ä½œæµæ¥å£
- å·¥ä½œæµçŠ¶æ€æŸ¥è¯¢
- æ‰§è¡Œç»“æœè·å–
- å®šæ—¶ä»»åŠ¡ç®¡ç†

## ğŸ”§ å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„
```
src/
â”œâ”€â”€ common/           # å…¬å…±æ¨¡å—
â”‚   â”œâ”€â”€ dto/         # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”œâ”€â”€ entities/    # åŸºç¡€å®ä½“ç±»
â”‚   â”œâ”€â”€ services/    # å…¬å…±æœåŠ¡
â”‚   â””â”€â”€ utils/       # å·¥å…·å‡½æ•°
â”œâ”€â”€ config/          # é…ç½®æ–‡ä»¶
â”œâ”€â”€ modules/         # ä¸šåŠ¡æ¨¡å—
â”‚   â”œâ”€â”€ watchlist/   # è‡ªé€‰è‚¡æ¨¡å—
â”‚   â”œâ”€â”€ health/      # å¥åº·æ£€æŸ¥æ¨¡å—
â”‚   â””â”€â”€ analysis/    # åˆ†ææ¨¡å—
â”œâ”€â”€ agents/          # æ™ºèƒ½ä½“æ¨¡å—
â”‚   â”œâ”€â”€ services/    # MCPå’ŒLLMæœåŠ¡
â”‚   â”œâ”€â”€ unified/     # ä¸“ä¸šæ™ºèƒ½ä½“
â”‚   â””â”€â”€ agents.module.ts
â”œâ”€â”€ temporal/        # Temporalç»Ÿä¸€æ¨¡å—
â”‚   â”œâ”€â”€ core/        # æ ¸å¿ƒç»„ä»¶
â”‚   â”œâ”€â”€ schedulers/  # è°ƒåº¦å™¨æœåŠ¡
â”‚   â”œâ”€â”€ workers/     # Workerå®ç°
â”‚   â”œâ”€â”€ workflows/   # å·¥ä½œæµå®šä¹‰
â”‚   â”œâ”€â”€ interfaces/  # æ¥å£å®šä¹‰
â”‚   â”œâ”€â”€ config/      # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ managers/    # ç®¡ç†å™¨
â”‚   â””â”€â”€ temporal.module.ts
â”œâ”€â”€ app.module.ts    # åº”ç”¨ä¸»æ¨¡å—
â””â”€â”€ main.ts          # åº”ç”¨å…¥å£
```

### æ•°æ®åº“è§„èŒƒ
- æ‰€æœ‰å®ä½“ç»§æ‰¿ `BaseEntity`
- ä½¿ç”¨è½¯åˆ é™¤ï¼Œä¸è¿›è¡Œç‰©ç†åˆ é™¤
- æ‰€æœ‰æŸ¥è¯¢é™åˆ¶æœ€å¤šå…³è”3å¼ è¡¨
- åˆ—è¡¨æ¥å£å¿…é¡»åˆ†é¡µï¼Œæœ€å¤š200æ¡è®°å½•

### å·¥ä½œæµå¼€å‘è§„èŒƒ
- **é˜¶æ®µåˆ†å·¥**: ç¬¬ä¸€é˜¶æ®µMCPæ•°æ®è·å–+LLMåŸºç¡€åˆ†æï¼Œç¬¬äºŒé˜¶æ®µçº¯LLMä¸“ä¸šåˆ†æï¼Œç¬¬ä¸‰é˜¶æ®µçº¯LLMå†³ç­–æ•´åˆ
- **æŒ‰éœ€è°ƒç”¨**: ä¸¥æ ¼éµå¾ªæŒ‰éœ€è°ƒç”¨åŸåˆ™ï¼Œæ¯ä¸ªæ™ºèƒ½ä½“åªè°ƒç”¨å…¶ä¸“é—¨è´Ÿè´£çš„MCPæœåŠ¡
- **æ ‡å‡†æµç¨‹**: å®Œå…¨éµå¾ªè‚¡ç¥¨åˆ†ææ ‡å‡†æµç¨‹ï¼ˆåŸºç¡€ä¿¡æ¯â†’åŸºæœ¬é¢â†’è¡Œä¸šâ†’ç«äº‰â†’å¸‚åœºæƒ…ç»ªâ†’ä¼°å€¼â†’é£é™©â†’ç»¼åˆåˆ¤æ–­ï¼‰
- **ç»“æœç»“æ„åŒ–**: æ‰€æœ‰åˆ†æç»“æœå¿…é¡»åŒ…å«ç½®ä¿¡åº¦è¯„åˆ†(0-100)ã€å…³é”®å†³ç­–å› ç´ ã€é£é™©è¯„ä¼°ã€è¡ŒåŠ¨è®¡åˆ’
- **æ•°æ®æµè½¬**: ç¬¬ä¸€é˜¶æ®µæ•°æ®ä¼ é€’ç»™åç»­é˜¶æ®µï¼Œé¿å…é‡å¤MCPè°ƒç”¨

### Temporalå·¥ä½œæµå¼€å‘è§„èŒƒ
- **å·¥ä½œæµåè°ƒ**: æ‰€æœ‰å¤æ‚ä¸šåŠ¡æµç¨‹é€šè¿‡Temporalå·¥ä½œæµç®¡ç†
- **åŸå­åŒ–æ´»åŠ¨**: æ¯ä¸ªServiceæ–¹æ³•ä½œä¸ºå•ä¸€Activityï¼Œä¿è¯åŸå­æ€§
- **çŠ¶æ€ç®¡ç†**: å·¥ä½œæµçŠ¶æ€ç”±Temporalè‡ªåŠ¨ç®¡ç†ï¼Œæ”¯æŒæ•…éšœæ¢å¤
- **é”™è¯¯é‡è¯•**: é€šè¿‡æ´»åŠ¨é‡è¯•ç­–ç•¥å¤„ç†ä¸´æ—¶æ€§é”™è¯¯
- **ç›‘æ§è¿½è¸ª**: æ‰€æœ‰å·¥ä½œæµæ‰§è¡ŒçŠ¶æ€å¯é€šè¿‡Web UIå®æ—¶ç›‘æ§

### ç¼“å­˜ç­–ç•¥  
- å¼€å‘é˜¶æ®µç¼“å­˜åŠŸèƒ½æš‚æ—¶ç¦ç”¨ (ENABLE_CACHE=false)
- Redisä»…ä½œä¸ºç¼“å­˜å±‚ï¼Œæ‰€æœ‰æ•°æ®å¿…é¡»è½ç›˜åˆ°PostgreSQL
- ç¼“å­˜é”®å‘½åè§„èŒƒ: `æ¨¡å—:æ–¹æ³•:å‚æ•°`  
- æ‰€æœ‰ç¼“å­˜å¿…é¡»è®¾ç½®TTLè¿‡æœŸæ—¶é—´

## ğŸ³ Docker éƒ¨ç½²

### ä½¿ç”¨ Docker Compose

#### å¿«é€Ÿå¯åŠ¨ï¼ˆä½¿ç”¨é»˜è®¤é…ç½®ï¼‰
```bash
docker-compose up -d
```

#### ä½¿ç”¨ç¯å¢ƒå˜é‡è‡ªå®šä¹‰é…ç½®

1. **å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿**:
```bash
cp .env.example .env
```

2. **ç¼–è¾‘ `.env` æ–‡ä»¶é…ç½®æ•°æ®åº“å¯†ç ç­‰**:
```bash
# PostgreSQL é…ç½®
POSTGRES_PASSWORD=mySecurePassword123
POSTGRES_DB=trading_agent

# Redis é…ç½®
REDIS_PASSWORD=myRedisPassword

# API å¯†é’¥
DASHSCOPE_API_KEY=your_actual_api_key
```

3. **ä½¿ç”¨è‡ªå®šä¹‰é…ç½®å¯åŠ¨**:
```bash
docker-compose up -d
```

> ğŸ“ **è¯´æ˜**: docker-compose ä¼šè‡ªåŠ¨åŠ è½½ .env æ–‡ä»¶ä¸­çš„ç¯å¢ƒå˜é‡

#### å¸¸ç”¨ç¯å¢ƒå˜é‡ç»„åˆ

**ä½¿ç”¨å‘½ä»¤è¡Œç¯å¢ƒå˜é‡ï¼ˆä¸´æ—¶è¦†ç›–ï¼‰**:
```bash
# ä¿®æ”¹æ•°æ®åº“å¯†ç 
POSTGRES_PASSWORD=newPassword docker-compose up -d

# ä½¿ç”¨Rediså¯†ç 
REDIS_PASSWORD=redisPass docker-compose up -d

# è‡ªå®šä¹‰ç«¯å£
# åº”ç”¨ç«¯å£ä¿®æ”¹ä¸º8080
APP_PORT=8080 docker-compose up -d

# æ•°æ®åº“æœåŠ¡ç«¯å£
POSTGRES_PORT=5433 REDIS_PORT=6380 docker-compose up -d
```

**å¯åŠ¨Redisç®¡ç†ç•Œé¢**:
```bash
docker-compose --profile redis-ui up -d
```

**å¯åŠ¨Temporalå·¥ä½œæµæœåŠ¡**:
```bash
# å¯åŠ¨TemporalæœåŠ¡é›†ç¾¤
docker-compose up temporal -d

# æŸ¥çœ‹Temporal Web UI (é»˜è®¤ç«¯å£8088)
open http://localhost:8088

# æŸ¥çœ‹TemporalæœåŠ¡çŠ¶æ€
docker-compose ps temporal temporal-admin-tools
```

### æ‰‹åŠ¨æ„å»º
```bash
# æ„å»ºé•œåƒ
docker build -t trading-agent-cn .

# è¿è¡Œå®¹å™¨
docker run -d \
  --name trading-agent-cn \
  -p 3000:3000 \
  -e DB_HOST=postgres \
  -e REDIS_HOST=redis \
  -e DASHSCOPE_API_KEY=your_api_key \
  trading-agent-cn
```

### Docker Compose ç¯å¢ƒå˜é‡è¯´æ˜

| å˜é‡å | é»˜è®¤å€¼ | è¯´æ˜ |
|---------|-------|------|
| `POSTGRES_VERSION` | `15` | PostgreSQLç‰ˆæœ¬ |
| `POSTGRES_PORT` | `5432` | PostgreSQLç«¯å£ |
| `POSTGRES_USER` | `postgres` | æ•°æ®åº“ç”¨æˆ·å |
| `POSTGRES_PASSWORD` | `test_123!` | æ•°æ®åº“å¯†ç  |
| `POSTGRES_DB` | `trading_agent` | æ•°æ®åº“å |
| `APP_PORT` | `3000` | åº”ç”¨å¯¹å¤–æœåŠ¡ç«¯å£ï¼ˆä¸»æœºç«¯å£ï¼‰ |
| `PORT` | `3000` | åº”ç”¨å†…éƒ¨ç«¯å£ï¼ˆå®¹å™¨ç«¯å£ï¼‰ |
| `REDIS_VERSION` | `7-alpine` | Redisç‰ˆæœ¬ |
| `REDIS_PORT` | `6379` | Redisç«¯å£ |
| `REDIS_PASSWORD` | `""` | Rediså¯†ç ï¼ˆç©ºä¸ºæ— å¯†ç ï¼‰ |
| `REDIS_COMMANDER_PORT` | `8081` | Redisç®¡ç†ç•Œé¢ç«¯å£ |
| `TEMPORAL_VERSION` | `1.22` | Temporal Serverç‰ˆæœ¬ |
| `TEMPORAL_UI_PORT` | `8088` | Temporal Web UIç«¯å£ |
| `TEMPORAL_HOST_PORT` | `7233` | Temporal Serverç«¯å£ |

## âš¡ Temporal å·¥ä½œæµè§„èŒƒ

### Namespace å‘½åè§„èŒƒ
**æ ¼å¼**: `{æ¨¡å—å}-{ç¯å¢ƒ}`

```bash
# ç¤ºä¾‹
agents-dev      # æ™ºèƒ½ä½“æ¨¡å—å¼€å‘ç¯å¢ƒ
agents-prd      # æ™ºèƒ½ä½“æ¨¡å—ç”Ÿäº§ç¯å¢ƒ
news-dev        # æ–°é—»æ¨¡å—å¼€å‘ç¯å¢ƒ
news-prd        # æ–°é—»æ¨¡å—ç”Ÿäº§ç¯å¢ƒ
watchlist-dev   # è‡ªé€‰è‚¡æ¨¡å—å¼€å‘ç¯å¢ƒ
analysis-prd    # åˆ†ææ¨¡å—ç”Ÿäº§ç¯å¢ƒ
```

### TaskQueue å‘½åè§„èŒƒ
**æ ¼å¼**: `{ä¸šåŠ¡åŸŸ}-{åŠŸèƒ½}`

```bash
# æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½
stock-analysis          # è‚¡ç¥¨åˆ†æä»»åŠ¡é˜Ÿåˆ—
portfolio-monitoring    # æŠ•èµ„ç»„åˆç›‘æ§ä»»åŠ¡é˜Ÿåˆ—

# æ™ºèƒ½åˆ†ææ¨¡å—
intelligent-analysis    # æ™ºèƒ½åˆ†æä»»åŠ¡é˜Ÿåˆ—

# è‡ªé€‰è‚¡æ¨¡å—
watchlist-monitoring    # è‡ªé€‰è‚¡ç›‘æ§ä»»åŠ¡é˜Ÿåˆ—
watchlist-alerts        # è‡ªé€‰è‚¡æé†’ä»»åŠ¡é˜Ÿåˆ—
```

### é…ç½®æ–¹å¼
- ğŸš« **ç§»é™¤å…¨å±€é…ç½®**: ä¸å†ä½¿ç”¨ `TEMPORAL_NAMESPACE` å’Œ `TEMPORAL_TASK_QUEUE` ç¯å¢ƒå˜é‡
- âœ… **æ¨¡å—è‡ªå®šä¹‰**: æ¯ä¸ªä¸šåŠ¡æ¨¡å—æ ¹æ®è§„èŒƒè‡ªè¡Œå®šä¹‰ namespace å’Œ taskQueue
- âœ… **ç»Ÿä¸€å‘½å**: æ‰€æœ‰ç¯å¢ƒä½¿ç”¨ç›¸åŒçš„ taskQueue å‘½åï¼Œä¸åšç¯å¢ƒåŒºåˆ†

### ä½¿ç”¨ç¤ºä¾‹
```typescript
// å®¢æˆ·ç«¯é…ç½®
const namespace = 'default';  // ç»Ÿä¸€ä½¿ç”¨ default namespace
const client = new Client({ connection, namespace });

// å·¥ä½œæµå¯åŠ¨
const taskQueue = 'stock-analysis';
const handle = await client.workflow.start(stockAnalysisWorkflow, {
  taskQueue,
  workflowId: `stock-analysis-${stockCode}-${Date.now()}`,
});

// Workeré…ç½®  
const worker = await Worker.create({
  workflowsPath: require.resolve('./workflows'),
  activities,
  taskQueue: 'stock-analysis',
});
```

## ğŸ“Š ç›‘æ§ä¸æ—¥å¿—

- åº”ç”¨æ—¥å¿—å­˜å‚¨åœ¨ `logs/` ç›®å½•
- æ”¯æŒç»“æ„åŒ–æ—¥å¿—è¾“å‡º (JSONæ ¼å¼)
- æä¾›å¥åº·æ£€æŸ¥ç«¯ç‚¹ç”¨äºç›‘æ§
- MCPè¿æ¥çŠ¶æ€å®æ—¶ç›‘æ§
- **å·¥ä½œæµç›‘æ§**: æ‰§è¡ŒçŠ¶æ€ã€æŒç»­æ—¶é—´ã€æˆåŠŸç‡
- **æ™ºèƒ½ä½“æ€§èƒ½æŒ‡æ ‡**: LLMè°ƒç”¨æ¬¡æ•°ã€å“åº”æ—¶é—´ã€æˆæœ¬ç»Ÿè®¡
- **Temporal Web UI**: http://localhost:8088 - å·¥ä½œæµæ‰§è¡ŒçŠ¶æ€ç›‘æ§
- **å·¥ä½œæµè¿½è¸ª**: å®Œæ•´çš„æ‰§è¡Œå†å²ã€å¤±è´¥é‡è¯•ã€æ€§èƒ½æŒ‡æ ‡

### ç›‘æ§é¡¹ç›®
- **MCPè°ƒç”¨ç»Ÿè®¡**: æ¯ä¸ªæ™ºèƒ½ä½“çš„MCPæœåŠ¡è°ƒç”¨æ¬¡æ•°å’Œæˆæœ¬
- **æ€§èƒ½åˆ†æ**: å„é˜¶æ®µçš„å¹³å‡è€—æ—¶å’Œèµ„æºæ¶ˆè€—
- **LLMä½¿ç”¨ç»Ÿè®¡**: Tokenæ¶ˆè€—ã€æ¨¡å‹é€‰æ‹©ã€è°ƒç”¨æˆåŠŸç‡
- **å†³ç­–è´¨é‡è¯„ä¼°**: ç½®ä¿¡åº¦åˆ†æ•°ã€å…³é”®å› ç´ è¯†åˆ«ç‡

## ğŸ§ª æµ‹è¯•æŒ‡å—

### è¿è¡Œæµ‹è¯•
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm run test

# è¿è¡Œå¢å¼ºç‰ˆå·¥ä½œæµæµ‹è¯•
npm test -- --testPathPattern="enhanced-stock-analysis"

# è¿è¡ŒMCPç›¸å…³æµ‹è¯•
npm test -- --testPathPattern="mcp"

# è¿è¡Œæ™ºèƒ½ä½“æµ‹è¯•
npm test -- --testPathPattern="agents"

# è¿è¡Œä¸‰é˜¶æ®µå·¥ä½œæµé›†æˆæµ‹è¯•
npm test -- --testPathPattern="agents-temporal-client.service.spec.ts"

# è¿è¡Œæµ‹è¯•å¹¶æŸ¥çœ‹è¦†ç›–ç‡
npm run test:cov
```

### æµ‹è¯•è¯´æ˜
- **å·¥ä½œæµæµ‹è¯•**: éªŒè¯å·¥ä½œæµçš„å®Œæ•´æ‰§è¡Œæµç¨‹
- **MCP+LLMé›†æˆæµ‹è¯•**: éªŒè¯MCPæ•°æ®è·å–å’ŒLLMæ™ºèƒ½åˆ†æçš„ç»“åˆ
- **æŒ‰éœ€è°ƒç”¨æµ‹è¯•**: éªŒè¯æ¯ä¸ªæ™ºèƒ½ä½“åªè°ƒç”¨å…¶ä¸“é—¨è´Ÿè´£çš„MCPæœåŠ¡
- **æ ‡å‡†æµç¨‹æµ‹è¯•**: éªŒè¯è‚¡ç¥¨åˆ†ææ ‡å‡†æµç¨‹çš„å®Œæ•´è¦†ç›–
- **ç»“æœç»“æ„æµ‹è¯•**: éªŒè¯åˆ†æç»“æœçš„ç»“æ„åŒ–è¾“å‡º

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æ‰“å¼€ Pull Request

## ğŸ“ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…

## ğŸ“ è”ç³»æˆ‘ä»¬

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤ [Issue](https://github.com/your-repo/trading-agent-cn/issues)

---

ğŸš€ **TradingAgentCN** - æ™ºèƒ½äº¤æ˜“å†³ç­–ç³»ç»Ÿï¼Œè®©æŠ•èµ„åˆ†ææ›´åŠ é«˜æ•ˆã€æ™ºèƒ½ã€ä¸“ä¸šï¼

**å†æ¬¡æé†’ï¼šæœ¬ç³»ç»Ÿä»…ä¾›å­¦ä¹ ç ”ç©¶ä½¿ç”¨ï¼Œä¸æ„æˆæŠ•èµ„å»ºè®®ï¼ŒæŠ•èµ„æœ‰é£é™©ï¼Œå†³ç­–éœ€è°¨æ…ï¼**